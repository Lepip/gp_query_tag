CREATE EXTENSION query_tag;
NOTICE:  QUERY_TAG: Table wlm_rules doesn't exist, abort.
SET QUERY_TAG TO "aboba=aboba";
NOTICE:  QUERY_TAG: Trying to fetch rules from wlm_rules, where resgname = admin_group and rolename = clepip
NOTICE:  QUERY_TAG: didn't find matching rules for the current query. Keeping original groupId.
NOTICE:  QUERY_TAG: Trying to fetch rules from wlm_rules, where resgname = admin_group and rolename = clepip
NOTICE:  QUERY_TAG: didn't find matching rules for the current query. Keeping original groupId.
NOTICE:  QUERY_TAG: Checking new tag
NOTICE:  QUERY_TAG: Free old one: 2135397528
NOTICE:  FREED: 2135397528
NOTICE:  QUERY_TAG: Setup new one: 2137724040
NOTICE:  Printing tags:
NOTICE:  0: aboba
NOTICE:  1: aboba
NOTICE:  heh, 1
NOTICE:  heh, 2  (seg0 127.0.1.1:6002 pid=779316)
NOTICE:  heh, 2  (seg1 127.0.1.1:6003 pid=779317)
NOTICE:  heh, 2  (seg2 127.0.1.1:6004 pid=779318)
-- weird query_tags
SET QUERY_TAG TO "a";
NOTICE:  QUERY_TAG: Trying to fetch rules from wlm_rules, where resgname = admin_group and rolename = clepip
NOTICE:  QUERY_TAG: didn't find matching rules for the current query. Keeping original groupId.
NOTICE:  QUERY_TAG: Checking new tag
NOTICE:  QUERY_TAG: Tag didn't pass parsing.
ERROR:  invalid value for parameter "QUERY_TAG": "a"
SHOW QUERY_TAG;
NOTICE:  QUERY_TAG: Trying to fetch rules from wlm_rules, where resgname = admin_group and rolename = clepip
NOTICE:  QUERY_TAG: didn't find matching rules for the current query. Keeping original groupId.
NOTICE:  Printing tags:
NOTICE:  0: aboba
NOTICE:  1: aboba
NOTICE:  Printing tags:
NOTICE:  0: aboba
NOTICE:  1: aboba
  QUERY_TAG  
-------------
 aboba=aboba
(1 row)

SET QUERY_TAG TO "=aboba";
NOTICE:  QUERY_TAG: Trying to fetch rules from wlm_rules, where resgname = admin_group and rolename = clepip
NOTICE:  QUERY_TAG: didn't find matching rules for the current query. Keeping original groupId.
NOTICE:  QUERY_TAG: Checking new tag
NOTICE:  QUERY_TAG: Tag didn't pass parsing.
ERROR:  invalid value for parameter "QUERY_TAG": "=aboba"
SHOW QUERY_TAG;
NOTICE:  QUERY_TAG: Trying to fetch rules from wlm_rules, where resgname = admin_group and rolename = clepip
NOTICE:  QUERY_TAG: didn't find matching rules for the current query. Keeping original groupId.
NOTICE:  Printing tags:
NOTICE:  0: aboba
NOTICE:  1: aboba
NOTICE:  Printing tags:
NOTICE:  0: aboba
NOTICE:  1: aboba
  QUERY_TAG  
-------------
 aboba=aboba
(1 row)

SET QUERY_TAG TO "a=a;";
NOTICE:  QUERY_TAG: Trying to fetch rules from wlm_rules, where resgname = admin_group and rolename = clepip
NOTICE:  QUERY_TAG: didn't find matching rules for the current query. Keeping original groupId.
NOTICE:  QUERY_TAG: Checking new tag
NOTICE:  QUERY_TAG: Tag didn't pass parsing.
ERROR:  invalid value for parameter "QUERY_TAG": "a=a;"
SHOW QUERY_TAG;
NOTICE:  QUERY_TAG: Trying to fetch rules from wlm_rules, where resgname = admin_group and rolename = clepip
NOTICE:  QUERY_TAG: didn't find matching rules for the current query. Keeping original groupId.
NOTICE:  Printing tags:
NOTICE:  0: aboba
NOTICE:  1: aboba
NOTICE:  Printing tags:
NOTICE:  0: aboba
NOTICE:  1: aboba
  QUERY_TAG  
-------------
 aboba=aboba
(1 row)

SET QUERY_TAG TO "a;";
NOTICE:  QUERY_TAG: Trying to fetch rules from wlm_rules, where resgname = admin_group and rolename = clepip
NOTICE:  QUERY_TAG: didn't find matching rules for the current query. Keeping original groupId.
NOTICE:  QUERY_TAG: Checking new tag
NOTICE:  QUERY_TAG: Tag didn't pass parsing.
ERROR:  invalid value for parameter "QUERY_TAG": "a;"
SHOW QUERY_TAG;
NOTICE:  QUERY_TAG: Trying to fetch rules from wlm_rules, where resgname = admin_group and rolename = clepip
NOTICE:  QUERY_TAG: didn't find matching rules for the current query. Keeping original groupId.
NOTICE:  Printing tags:
NOTICE:  0: aboba
NOTICE:  1: aboba
NOTICE:  Printing tags:
NOTICE:  0: aboba
NOTICE:  1: aboba
  QUERY_TAG  
-------------
 aboba=aboba
(1 row)

SET QUERY_TAG TO "123=123";
NOTICE:  QUERY_TAG: Trying to fetch rules from wlm_rules, where resgname = admin_group and rolename = clepip
NOTICE:  QUERY_TAG: didn't find matching rules for the current query. Keeping original groupId.
NOTICE:  QUERY_TAG: Checking new tag
NOTICE:  QUERY_TAG: Free old one: 2137724040
NOTICE:  FREED: 2137724040
NOTICE:  QUERY_TAG: Setup new one: 2135397528
NOTICE:  Printing tags:
NOTICE:  0: 123
NOTICE:  1: 123
NOTICE:  heh, 1
NOTICE:  heh, 2  (seg0 127.0.1.1:6002 pid=779316)
NOTICE:  heh, 2  (seg1 127.0.1.1:6003 pid=779317)
NOTICE:  heh, 2  (seg2 127.0.1.1:6004 pid=779318)
SHOW QUERY_TAG;
NOTICE:  QUERY_TAG: Trying to fetch rules from wlm_rules, where resgname = admin_group and rolename = clepip
NOTICE:  QUERY_TAG: didn't find matching rules for the current query. Keeping original groupId.
NOTICE:  Printing tags:
NOTICE:  0: 123
NOTICE:  1: 123
NOTICE:  Printing tags:
NOTICE:  0: 123
NOTICE:  1: 123
 QUERY_TAG 
-----------
 123=123
(1 row)

SET QUERY_TAG TO ";";
NOTICE:  QUERY_TAG: Trying to fetch rules from wlm_rules, where resgname = admin_group and rolename = clepip
NOTICE:  QUERY_TAG: didn't find matching rules for the current query. Keeping original groupId.
NOTICE:  QUERY_TAG: Checking new tag
NOTICE:  QUERY_TAG: Tag didn't pass parsing.
ERROR:  invalid value for parameter "QUERY_TAG": ";"
SHOW QUERY_TAG;
NOTICE:  QUERY_TAG: Trying to fetch rules from wlm_rules, where resgname = admin_group and rolename = clepip
NOTICE:  QUERY_TAG: didn't find matching rules for the current query. Keeping original groupId.
NOTICE:  Printing tags:
NOTICE:  0: 123
NOTICE:  1: 123
NOTICE:  Printing tags:
NOTICE:  0: 123
NOTICE:  1: 123
 QUERY_TAG 
-----------
 123=123
(1 row)

-- complex behaviour
-- should set to rgroup1
CREATE RESOURCE GROUP rgroup1 WITH (CPU_RATE_LIMIT=20, MEMORY_LIMIT=25, MEMORY_SPILL_RATIO=20);
NOTICE:  QUERY_TAG: Trying to fetch rules from wlm_rules, where resgname = admin_group and rolename = clepip
NOTICE:  QUERY_TAG: didn't find matching rules for the current query. Keeping original groupId.
ERROR:  resource group "rgroup1" already exists
CREATE RESOURCE GROUP rgroup2 WITH (CPU_RATE_LIMIT=20, MEMORY_LIMIT=25, MEMORY_SPILL_RATIO=20);
NOTICE:  QUERY_TAG: Trying to fetch rules from wlm_rules, where resgname = admin_group and rolename = clepip
NOTICE:  QUERY_TAG: didn't find matching rules for the current query. Keeping original groupId.
ERROR:  resource group "rgroup2" already exists
INSERT INTO wlm_rules (resgname, role, dest_resg, order_id, query_tag, active)
    VALUES ('admin_group', 'clepip', 'rgroup1', 3, 'group=rgroup1', TRUE);
NOTICE:  QUERY_TAG: Trying to fetch rules from wlm_rules, where resgname = admin_group and rolename = clepip
NOTICE:  QUERY_TAG: didn't find matching rules for the current query. Keeping original groupId.
INSERT INTO wlm_rules (resgname, role, dest_resg, order_id, query_tag, active)
    VALUES ('admin_group', 'clepip', 'rgroup2', 4, 'group=rgroup1', TRUE);
NOTICE:  QUERY_TAG: Trying to fetch rules from wlm_rules, where resgname = admin_group and rolename = clepip
NOTICE:  Printing gucs in istaginguc  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing guc:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing rule:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  0: group  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  1: rgroup1  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  FREED: -2091468360  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  QUERY_TAG: didn't find matching rules for the current query. Keeping original groupId.
SET QUERY_TAG TO "group=rgroup1";
NOTICE:  QUERY_TAG: Trying to fetch rules from wlm_rules, where resgname = admin_group and rolename = clepip
NOTICE:  Printing gucs in istaginguc  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing guc:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing rule:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  0: group  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  1: rgroup1  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  FREED: -2091468360  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing gucs in istaginguc  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing guc:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing rule:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  0: group  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  1: rgroup1  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  FREED: -2091468360  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  QUERY_TAG: didn't find matching rules for the current query. Keeping original groupId.
NOTICE:  QUERY_TAG: Checking new tag
NOTICE:  QUERY_TAG: Free old one: 2135397528
NOTICE:  FREED: 2135397528
NOTICE:  QUERY_TAG: Setup new one: 2137732168
NOTICE:  Printing tags:
NOTICE:  0: group
NOTICE:  1: rgroup1
NOTICE:  heh, 1
NOTICE:  heh, 2  (seg0 127.0.1.1:6002 pid=779316)
NOTICE:  heh, 2  (seg2 127.0.1.1:6004 pid=779318)
NOTICE:  heh, 2  (seg1 127.0.1.1:6003 pid=779317)
SELECT current_resgroup();
NOTICE:  QUERY_TAG: Trying to fetch rules from wlm_rules, where resgname = admin_group and rolename = clepip
NOTICE:  Printing gucs in istaginguc  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing guc:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing rule:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  0: group  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  1: rgroup1  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  FREED: -2091468360  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing gucs in istaginguc  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing guc:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing rule:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  0: group  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  1: rgroup1  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  FREED: -2091468360  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  QUERY_TAG: didn't find matching rules for the current query. Keeping original groupId.
 current_resgroup 
------------------
 admin_group
(1 row)

-- should still set to rgroup1 (we are in admin_group, the "current_rsgroup" shows group after
--- applying tags, and tags are applied accordingly to users rsgroup)
INSERT INTO wlm_rules (resgname, role, dest_resg, order_id, query_tag, active)
    VALUES ('rgroup1', 'clepip', 'rgroup2', 1, 'group=still_1', TRUE);
NOTICE:  QUERY_TAG: Trying to fetch rules from wlm_rules, where resgname = admin_group and rolename = clepip
NOTICE:  Printing gucs in istaginguc  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing guc:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing rule:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  0: group  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  1: rgroup1  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  FREED: -2091468360  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing gucs in istaginguc  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing guc:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing rule:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  0: group  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  1: rgroup1  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  FREED: -2091468360  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  QUERY_TAG: didn't find matching rules for the current query. Keeping original groupId.
INSERT INTO wlm_rules (resgname, role, dest_resg, order_id, query_tag, active)
    VALUES ('admin_group', 'clepip', 'rgroup1', 5, 'group=still_1', TRUE);
NOTICE:  QUERY_TAG: Trying to fetch rules from wlm_rules, where resgname = admin_group and rolename = clepip
NOTICE:  Printing gucs in istaginguc  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing guc:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing rule:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  0: group  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  1: rgroup1  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  FREED: -2091468360  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing gucs in istaginguc  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing guc:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing rule:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  0: group  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  1: rgroup1  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  FREED: -2091468360  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing gucs in istaginguc  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing guc:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing rule:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  0: group  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  1: still_1  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  FREED: -2091468360  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  QUERY_TAG: didn't find matching rules for the current query. Keeping original groupId.
SET QUERY_TAG TO "group=still_1";
NOTICE:  QUERY_TAG: Trying to fetch rules from wlm_rules, where resgname = admin_group and rolename = clepip
NOTICE:  Printing gucs in istaginguc  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing guc:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing rule:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  0: group  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  1: rgroup1  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  FREED: -2091468360  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing gucs in istaginguc  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing guc:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing rule:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  0: group  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  1: rgroup1  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  FREED: -2091468360  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing gucs in istaginguc  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing guc:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing rule:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  0: group  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  1: still_1  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  FREED: -2091468360  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing gucs in istaginguc  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing guc:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing rule:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  0: group  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  1: still_1  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  FREED: -2091468360  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  QUERY_TAG: didn't find matching rules for the current query. Keeping original groupId.
NOTICE:  QUERY_TAG: Checking new tag
NOTICE:  QUERY_TAG: Free old one: 2137732168
NOTICE:  FREED: 2137732168
NOTICE:  QUERY_TAG: Setup new one: 2135397528
NOTICE:  Printing tags:
NOTICE:  0: group
NOTICE:  1: still_1
NOTICE:  heh, 1
NOTICE:  heh, 2  (seg0 127.0.1.1:6002 pid=779316)
NOTICE:  heh, 2  (seg2 127.0.1.1:6004 pid=779318)
NOTICE:  heh, 2  (seg1 127.0.1.1:6003 pid=779317)
SELECT CURRENT_RESGROUP();
NOTICE:  QUERY_TAG: Trying to fetch rules from wlm_rules, where resgname = admin_group and rolename = clepip
NOTICE:  Printing gucs in istaginguc  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing guc:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing rule:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  0: group  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  1: rgroup1  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  FREED: -2091468360  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing gucs in istaginguc  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing guc:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing rule:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  0: group  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  1: rgroup1  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  FREED: -2091468360  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing gucs in istaginguc  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing guc:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing rule:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  0: group  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  1: still_1  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  FREED: -2091468360  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing gucs in istaginguc  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing guc:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing rule:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  0: group  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  1: still_1  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  FREED: -2091468360  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  QUERY_TAG: didn't find matching rules for the current query. Keeping original groupId.
 current_resgroup 
------------------
 admin_group
(1 row)

-- should set to rgroup1
INSERT INTO wlm_rules (resgname, role, dest_resg, order_id, query_tag, active)
    VALUES ('admin_group', 'clepip', 'rgroup2', 1, 'group=cancelled', FALSE);
NOTICE:  QUERY_TAG: Trying to fetch rules from wlm_rules, where resgname = admin_group and rolename = clepip
NOTICE:  Printing gucs in istaginguc  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing guc:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing rule:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  0: group  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  1: rgroup1  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  FREED: -2091468360  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing gucs in istaginguc  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing guc:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing rule:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  0: group  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  1: rgroup1  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  FREED: -2091468360  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing gucs in istaginguc  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing guc:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing rule:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  0: group  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  1: still_1  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  FREED: -2091468360  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing gucs in istaginguc  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing guc:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing rule:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  0: group  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  1: still_1  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  FREED: -2091468360  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  QUERY_TAG: didn't find matching rules for the current query. Keeping original groupId.
INSERT INTO wlm_rules (resgname, role, dest_resg, order_id, query_tag, active)
    VALUES ('admin_group', 'clepip', 'rgroup1', 2, 'group=cancelled', TRUE);
NOTICE:  QUERY_TAG: Trying to fetch rules from wlm_rules, where resgname = admin_group and rolename = clepip
NOTICE:  Printing gucs in istaginguc  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing guc:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing rule:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  0: group  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  1: rgroup1  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  FREED: -2091468360  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing gucs in istaginguc  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing guc:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing rule:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  0: group  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  1: rgroup1  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  FREED: -2091468360  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing gucs in istaginguc  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing guc:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing rule:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  0: group  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  1: still_1  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  FREED: -2091468360  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing gucs in istaginguc  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing guc:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing rule:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  0: group  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  1: still_1  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  FREED: -2091468360  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  QUERY_TAG: didn't find matching rules for the current query. Keeping original groupId.
SET QUERY_TAG TO "group=cancelled";
NOTICE:  QUERY_TAG: Trying to fetch rules from wlm_rules, where resgname = admin_group and rolename = clepip
NOTICE:  Printing gucs in istaginguc  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing guc:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing rule:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  0: group  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  1: rgroup1  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  FREED: -2091468360  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing gucs in istaginguc  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing guc:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing rule:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  0: group  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  1: rgroup1  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  FREED: -2091468360  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing gucs in istaginguc  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing guc:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing rule:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  0: group  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  1: still_1  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  FREED: -2091468360  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing gucs in istaginguc  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing guc:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing rule:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  0: group  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  1: still_1  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  FREED: -2091468360  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing gucs in istaginguc  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing guc:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing rule:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  0: group  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  1: cancelled  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  FREED: -2091468360  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  QUERY_TAG: didn't find matching rules for the current query. Keeping original groupId.
NOTICE:  QUERY_TAG: Checking new tag
NOTICE:  QUERY_TAG: Free old one: 2135397528
NOTICE:  FREED: 2135397528
NOTICE:  QUERY_TAG: Setup new one: 2137732168
NOTICE:  Printing tags:
NOTICE:  0: group
NOTICE:  1: cancelled
NOTICE:  heh, 1
NOTICE:  heh, 2  (seg0 127.0.1.1:6002 pid=779316)
NOTICE:  heh, 2  (seg2 127.0.1.1:6004 pid=779318)
NOTICE:  heh, 2  (seg1 127.0.1.1:6003 pid=779317)
SELECT CURRENT_RESGROUP();
NOTICE:  QUERY_TAG: Trying to fetch rules from wlm_rules, where resgname = admin_group and rolename = clepip
NOTICE:  Printing gucs in istaginguc  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing guc:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing rule:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  0: group  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  1: rgroup1  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  FREED: -2091468360  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing gucs in istaginguc  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing guc:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing rule:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  0: group  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  1: rgroup1  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  FREED: -2091468360  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing gucs in istaginguc  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing guc:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing rule:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  0: group  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  1: still_1  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  FREED: -2091468360  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing gucs in istaginguc  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing guc:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing rule:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  0: group  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  1: still_1  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  FREED: -2091468360  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing gucs in istaginguc  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing guc:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing rule:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  Printing tags:  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  0: group  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  1: cancelled  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  FREED: -2091468360  (seg0 slice1 127.0.1.1:6002 pid=779316)
NOTICE:  QUERY_TAG: didn't find matching rules for the current query. Keeping original groupId.
 current_resgroup 
------------------
 admin_group
(1 row)

